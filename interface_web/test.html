<!DOCTYPE html>

<head>
	<title>Test</title>
	<meta charset="UTF-8">
	<script>
		var sessionID=0;
		var jx=-1;
		var jy=-1;
	</script>
	
	<link rel="stylesheet" type="text/css" href="./css/style.css">

	
</head>

<body>
	<div id="titre">
	<button class="boutton" style="float:left;" name="index" onclick='window.location="index.html'>Retour</button>
	<h1>Partie solo</h1>
	</div>
	<div id="game">
		<canvas id="myCanvas" width="430" height="430">
		</canvas> 
		
		<script>
			var etat=[];
			for (var i=0; i<10; i++){
				etat[i]=[];
			}
			etat[0][0]=0;
			etat[0][1]=-1;
			etat[0][2]=1;
			etat[0][3]=1;
			etat[0][4]=1;
			etat[0][5]=-1;
			etat[0][6]=1;
			etat[0][7]=1;
			etat[0][8]=1;
			etat[0][9]=1;
			etat[1][0]=0;
			etat[1][1]=0;
			etat[1][2]=-1;
			etat[1][3]=-1;
			etat[1][4]=-1;
			etat[1][5]=-1;
			etat[1][6]=-1;
			etat[1][7]=-1;
			etat[1][8]=-1;
			etat[1][9]=-1;
			etat[2][0]=0;
			etat[2][1]=0;
			etat[2][2]=-1;
			etat[2][3]=1;
			etat[2][4]=1;
			etat[2][5]=1;
			etat[2][6]=1;
			etat[2][7]=1;
			etat[2][8]=-1;
			etat[2][9]=0;
			etat[3][0]=0;
			etat[3][1]=0;
			etat[3][2]=0;
			etat[3][3]=-1;
			etat[3][4]=-1;
			etat[3][5]=-1;
			etat[3][6]=-1;
			etat[3][7]=-1;
			etat[3][8]=0;
			etat[3][9]=0;
			etat[4][0]=0;
			etat[4][1]=0;
			etat[4][2]=0;
			etat[4][3]=0;
			etat[4][4]=0;
			etat[4][5]=0;
			etat[4][6]=-1;
			etat[4][7]=0;
			etat[4][8]=0;
			etat[4][9]=0;
			etat[5][0]=0;
			etat[5][1]=0;
			etat[5][2]=0;
			etat[5][3]=0;
			etat[5][4]=0;
			etat[5][5]=-1;
			etat[5][6]=1;
			etat[5][7]=-1;
			etat[5][8]=0;
			etat[5][9]=0;
			etat[6][0]=0;
			etat[6][1]=0;
			etat[6][2]=0;
			etat[6][3]=0;
			etat[6][4]=0;
			etat[6][5]=-1;
			etat[6][6]=1;
			etat[6][7]=-1;
			etat[6][8]=0;
			etat[6][9]=0;
			etat[7][0]=0;
			etat[7][1]=0;
			etat[7][2]=0;
			etat[7][3]=0;
			etat[7][4]=0;
			etat[7][5]=-1;
			etat[7][6]=1;
			etat[7][7]=-1;
			etat[7][8]=0;
			etat[7][9]=0;
			etat[8][0]=0;
			etat[8][1]=0;
			etat[8][2]=0;
			etat[8][3]=0;
			etat[8][4]=-1;
			etat[8][5]=-1;
			etat[8][6]=-1;
			etat[8][7]=0;
			etat[8][8]=0;
			etat[8][9]=0;
			etat[9][0]=0;
			etat[9][1]=0;
			etat[9][2]=0;
			etat[9][3]=-1;
			etat[9][4]=1;
			etat[9][5]=1;
			etat[9][6]=-1;
			etat[9][7]=0;
			etat[9][8]=0;
			etat[9][9]=0;
			
			var canvas = document.getElementById("myCanvas");
			var ctx = canvas.getContext("2d");
			// Marges
			var margeLeft=30;
			var margeTop=30;
			// Largeur des cases
			var largCase=40;

			// Gestion des cases
				// Conversion des coordonnées
			function case2coord(i,j){
				// Récupère les coordonnées graphiques du coin en haut à gauche de la case
				return {'x':margeLeft+i*largCase, 'y':margeTop+j*largCase};
			}

			function coord2case(x,y){
				// Récupère les coordonnées d'une case	
				return {'i':Math.floor((x-margeLeft)/largCase), 'j':Math.floor((y-margeTop)/largCase)};
			}
				// Marquage des cases
			function marqueCase(i,j,etat){
				// Marque une case suivant son état
				if (etat=='touche'){
					ctx.fillStyle = "#FF0000";
				} else if (etat=='manque'){
					ctx.fillStyle = "#00FF00";
				} else if (etat=='bateau'){
					ctx.fillStyle = "#00FFFF";
				} else {
					ctx.fillStyle = "#FFFFFF";
				}
				x = case2coord(i,j).x;
				y = case2coord(i,j).y;
				ctx.fillRect(x+1,y+1,largCase-2,largCase-2);
			}

			// Événements souris
			var elem = document.getElementById('myCanvas'),
				elemLeft = elem.offsetLeft,
				elemTop = elem.offsetTop;
			elem.addEventListener('click', function(event) {
				var x = event.pageX - elemLeft-16,
					y = event.pageY - elemTop-16;
				//~ alert(x+','+y);
				if (x<margeLeft||x>margeLeft+10*largCase||y<margeTop||y>margeTop+10*largCase){
					return null;
				}
				i=coord2case(x,y).i;
				j=coord2case(x,y).j;
				jx = i;
				jy = j;
				//~ marqueCase(i,j,'touche');
				//~ window.location="cgi-bin/solo.py?id="+sessionID+"&jx="+jx+"&jy="+jy;
				if (etat[i][j]==1){
					marqueCase(i,j,'touche');
				} else {
					marqueCase(i,j,'manque');
				}
			});

			// Dessin de la grille
			ctx.font = "20px Arial";
			ctx.textAlign = "center";
				// Lignes
			for(var i=0;i<10;i++){
				ctx.fillText(String.fromCharCode(65+i),margeLeft+largCase/2+largCase*i,margeTop-5);
				//~ ctx.fillText(i,margeLeft+largCase/2+largCase*i,margeTop-5);
			}
			for(var i=0;i<=10;i++){	
				ctx.moveTo(margeLeft,margeLeft+largCase*i);
				ctx.lineTo(margeLeft+10*largCase, margeLeft+largCase*i);
				ctx.stroke();
			}
				// Colonnes
			for(var i=0;i<10;i++){		
				ctx.fillText(i,margeLeft-15,margeTop+largCase/2+5+largCase*i);
			}
			for(var i=0;i<=10;i++){	
				ctx.moveTo(margeLeft+largCase*i,margeTop);
				ctx.lineTo(margeLeft+largCase*i,margeTop+10*largCase);
				ctx.stroke();
			}



		</script>
		
	<!--
		<form  method=POST action="cgi-bin/test_cgi.py?id=123">
			<button style="margin:auto; margin-top:10px; display:block;" type="submit" name="next">Coup suivant</button>
		</form>
	-->
	<p id="infos">
	A5 touché
	<br>
	J'élimine la cases A7 : zone trop petite pour le plus petit bateau de taille 3 
	</p>
</div>
<button class="boutton" name="next" onclick='window.location="cgi-bin/solo.py?id="+sessionID'>Coup suivant</button>

</body>
